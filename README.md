# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/common/ — папка с компонентами

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базоваую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовком запроса  
**Методы**:

- `get` - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр прни вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра вызова

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для орбаботки и в слоях приложения для генерации событий.  
**Методы**, реализуемые классом описаны интерфейсом 'IEvents':

- `on` - подписка на события
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализуется требуемое в параметрах событие

Дополнительно реализованы методы `onAll` и `offAll` — для подписки на все события и сброса всех подписчиков.

#### Класс Component

Абстрактный класс для создания переиспользуемых UI компонентов и предоставляет инструментарий для работы с DOM в дочерних компонентах. Является слоем представления.  
**Методы**:

- `toggleClass` - переключает CSS-класс. Принимает HTML-элемент, название класса и опционально логическое значение принудительного добавления/удаления класса
- `setText` - устанавливает текстовое содержимое. Принимает HTML-элемент и текстовое содержимое
- `setDisabled` - устанавливает состояние блокировки. Принимает HTML-элемент и логическое значение, указывающее необходимость установки блокировки
- `setHidden` - скрывает указанный HTML-элемент, устанавливая его свойство display в 'none'
- `setVisible` - показывает указанный HTML-элемент, удаляя его свойство display
- `setImage` - устанавливает источник изображения и альтернативный текст. Принимает HTML-элемент, ссылку на изображение и оционально альтернативное название
- `render` - изображает компонент с опциональными данными и возвращает корневой контейнер.

#### Класс Model

Абстрактный класс представляет собой базовый механизм, предназначенный для работы с данными и управлениями изменениями. Его конструктор создает новый экземпляр модели с указанными данными и событиями, которые реализует `IEvents`. Является слоем данных.  
Методы:

- `emitChanges` - позволяет отправлять события с данными о изменениях необходимым компонентам или модулям.

### Слой данных

#### Класс AppState

Класс расширяет `Model` и отвечает за хранение и логику работы с данными. В полях содержит свойства для хранения карточек каталога, предметов корзины, идентификатора открытого элемента, информации о заказе и ошибок формы.  
**Методы**:

- `setCatalog` - для получения каталога товаров
- `setPreview` - для предпросмотра товара
- `toggleOrderedItem` - для изменении статуса товара "в корзине" или "не в корзине". Отправляет событие об изменении
- `getTotal` - для установки итоговой цены за товары. Отправляет событие об изменении
- `clearBasket` - очищает корзину от товаров. Отправляет событие об изменении
- `validateOrder` - проверка формы заказа о правильном заполнении полей форм. Отправляет событие об изменении

### Слой представления

Все классы представления отвечают за отображение внутри контейнера передаваемых в них данных. Главным родительским классом всех далее указанных классов является базовый компонент `Component<T>`, где `<T>` представляет используемый элементом интерфейс или тип.

#### Класс Modal

Класс на основе интерфейса `IModalData`, который представляет собой универсальный инструмент реализации модального окна, в котором меняется основной контент через шаблоны (карточка, корзина, формы).

Инициализирует элементы корзины, такие как кнопка закрытия и контент.
В конструкторе принимает _container_ в качестве HTML-элемента модального окна и _events_ для управления событиями.  
Устанавливает обработчики событий для уже найденной кнопки закрытия, клика за пределами окна и предотвращение закрытия при клике внутри контента.

**Свойства**:

- `content` - устанавливает содержимое модального окна, заменяя текущее содержимое новым

**Методы**:

- `open` - открывает модальное окно
- `close` - закрывает модальное окно
- `render` - сначала вызывает родительский метод `render`, которому передается содержание окна, затем открывается модальное окно и выводится его содержимое пользователю

#### Класс Page

Класс на основе интерфейса `IPage` является компонентом страницы и предоставляет методы для управления элементами страницы . Он имеет следующеие защищенные поля HTML-элементов: обертка страницы, отображение каталога с карточками, отображения корзины и количества товаров в нем.  
**Свойства**:

- `counter` - устанавливает значение счетчика.
- `catalog` - заменяет содержимое каталога новыми элементами.
- `locked` - управляет видимостью и доступностью элементов страницы, позволяя или запрещая пользовательские действия.

#### Класс Form

Класс на основе интерфейса `IForm` представляет собой компонент формы, который управляет визуальным представлением и состоянием форм.
Свойства:

- `valid` - устанавливает состояние кнопки в зависимости от валидности формы
- `errors` - устанавливает текст сообщения об ошибке в область для вывода ошибок формы.

**Методы**:

- `clearValue` - очищает поля формы
- `onInputChange` - защищенный метод, обрабатывает событие ввода данных в поля формы. Отправляет событие об изменении
- `render` - отрисовывает компонент на странице, обновляет состояние формы, включая валидность и список ошибок

#### Класс OrderPayment

Класс расширяет `Form` на основе типа `TOrderPayment`. В конструкторе инициализирует кнопки выбора способа оплаты для дальнейшнего использования в методе.
Свойства:

- `payment` - устанавливает способ заказа
- `address` - устанавливает адресс

**Методы**:

- `handlePaymentMethod` - проверяет выбранный способ заказа

#### Класс OrderContact

Класс расширяет `Form` на основе типа `TOrderContacts`.
Свойства:

- `email` - устанавливает почту
- `phone` - устанавливает номер телефона

#### Класс Success

Расширяет `Component` на освнове интерфейса `ISuccess`, появляется при успешном выполнении операций классов `OrderPayment` и `OrderContact` и отображает сообщение об успешном завершении заказа и вторым параметром принимает обработчик события при закрытии окна
Свойста:

- `total` - представляет итоговую сумму заказа

#### Класс Basket

Класс представляет собой компонент корзины, который на основе интерфейса `IBasket` отображает список элементов в корзине, их общую стоимость и предоставляет возможность перехода к оформлению заказа.
Свойства:

- `items` - устанаваливает список элементов в корзину
- `sum` - устанавливает сумму всех товаров

#### Класс Card

Класс представляет собой компонент краточки на основе интерфейса `ICard`, который содержит информацию о товаре. Конструктор принимает контейнер и объект actions типа `ICardActions`, который содержит действия, доступные для выполнения при взаимодействии с карточкой товара.
Свойства:

- `id` - устанавливается id для карточки
- `title` - устанавливает название карточки
- `description` - устанавливается описание карточки
- `price` - устанавливает цену карточки, при этом идет проверка - если с сервера цена `null`, то по ТЗ добавить в корзину ее нельзя и ее текст заменяется на _Бесценно_
- `image` - устанавливает картинку для карточки
- `category` - устанавливает категорию карточки
- `buttonText` - меняет текс на кнопке в зависимости находится ли товар в корзине или нет

#### Класс BasketCard

Расширяет `Card`, который представляет собой другой вид карточки для корзины. В полях указываются номер карточки, название, цена и новая кнопка удаления карточки из корзиныю
Свойства:

- `index` - устанавливает номер карточки по ее индеку

### Слой презентера

Веб-ларек является небольшим приложением и слоем представлением фактически будет тот код, который находится в корневом `src\index.ts`, где все соединяется через колбэки или события компоненты и API. Возможна полноценная реализация по мере разработки приложения.

<!-- ### Презентер для карточки

### Презентер для заказа

### Презентер для корзины -->

## Данные и типы данных, используемые в приложении

Данные и типы данных, используемые в приложении находятся в `src\types\index.ts`

## Описание событий

Будет заполняться и описываться по мере реализации приложения
| Событие | | Реакция |
|:----------:|----------|----------|
| `cards:changed` | | |
| `cards:preview` | | |
| `modal:open` | | |
| `modal:close` | | |
| `order:open` | | |
| `order:submit` | | |
| `order:change` | | |

## Размещение в сети

...
